{% extends 'base.html' %}

{% block content %}
<h1 class="text-3xl font-bold mb-6 text-center md:text-center">Criar Agendamento</h1>
<div class="bg-white shadow-md rounded-lg p-6 max-w-2xl mx-auto">
    <form method="post" class="space-y-6">
        {% csrf_token %}
        {% for field in form %}
            <div class="flex flex-col">
                <label for="{{ field.id_for_label }}" class="text-sm font-medium text-gray-700 mb-1">{{ field.label }}</label>
                {% if field.name == 'client' %}
                    <input type="hidden" name="client_id" id="id_client_id">
                    {{ field }}
                    <div id="id_client_suggestions" class="border rounded-lg mt-1 max-h-40 overflow-y-auto hidden"></div>
                {% else %}
                    {{ field }}
                {% endif %}
                {% if field.errors %}
                    <span class="text-red-500 text-sm">{{ field.errors|join:", " }}</span>
                {% endif %}
            </div>
        {% endfor %}
        <button type="submit" class="bg-blue-500 text-white px-6 py-3 rounded-lg shadow hover:bg-blue-600 w-full md:w-auto">Salvar</button>
    </form>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
    $(document).ready(function() {
        const input = $('#client-search');
        const hiddenId = $('#id_client_id');
        const suggestions = $('#id_client_suggestions');

        input.on('input', function() {
            const term = $(this).val();
            if (term.length < 1) {
                suggestions.empty().addClass('hidden');
                return;
            }

            $.getJSON('/salon/ajax/client/', { term: term }, function(data) {
                suggestions.empty();
                if (data.results.length > 0) {
                    data.results.forEach(result => {
                        const div = $('<div class="p-2 hover:bg-gray-100 cursor-pointer"></div>')
                            .text(result.text)
                            .data('id', result.id)
                            .on('click', function() {
                                input.val(result.text);
                                hiddenId.val(result.id);
                                suggestions.addClass('hidden');
                            });
                        suggestions.append(div);
                    });
                    suggestions.removeClass('hidden');
                } else {
                    suggestions.addClass('hidden');
                }
            });
        });

        $(document).on('click', function(e) {
            if (!suggestions.is(e.target) && suggestions.has(e.target).length === 0) {
                suggestions.addClass('hidden');
            }
        });
    });
</script>
<script>
    {% if messages %}
        {% for message in messages %}
            alert("{{ message }}");
        {% endfor %}
    {% endif %}
</script>
<style>
    #id_service, #id_team_member {
        border: 1px solid #d1d5db; /* Cor padr√£o do Tailwind 'border' */
        border-radius: 0.375rem; /* Equivalente a 'rounded-lg' */
        padding: 0.5rem 1rem; /* Equivalente a 'px-4 py-2' */
        width: 100%;
    }
    #id_service, #id_team_member, #id_appointment_time, #id_status {
        border: 1px solid #d1d5db;
        border-radius: 0.375rem;
        padding: 0.5rem 1rem;
        width: 100%;
    }
</style>
{% endblock %}